--Puxa o consumo do mês, relacionado às compras por fornecedor (1)
select b.cod_pac, b.data_mov, a.lote, a.validade, a.cod_prd from esmovite a, esmovcad b
where a.documento = b.documento and a.tipo_documento = b.tipo_documento
and b.tipo_documento = 'REQ' and b.data_mov between '01/01/2016' and '30/11/2016' and b.cod_pac is not null and a.lote in (
select a.lote from esmovite a, esmovcad b
where a.documento = b.documento and a.tipo_documento = b.tipo_documento
and b.tipo_documento = 'COM' and b.data_mov between '01/10/2015' and '30/11/2016' and b.cod_for = '018654' and a.lote <> 'S/L')
--Na planilha, concatena cod_pac & cod_prd e joga data_mov para a última coluna

--Puxa o faturado do mês, de OPME relacionado ao script acima (2)
select fatura, cod_prd, valor_tot, cod_pac from fafatprd where cod_pac in (
select b.cod_pac from esmovite a, esmovcad b
where a.documento = b.documento and a.tipo_documento = b.tipo_documento
and b.tipo_documento = 'REQ' and b.data_mov between '01/01/2016' and '30/11/2016' and b.cod_pac is not null and a.lote in (
select a.lote from esmovite a, esmovcad b
where a.documento = b.documento and a.tipo_documento = b.tipo_documento
and b.tipo_documento = 'COM' and b.data_mov between '01/10/2015' and '30/11/2016' and b.cod_for = '018654' and a.lote <> 'S/L'))
and cod_prd in (select codigo from faprdcad where tipo_prd = 'OPM')
--Na planilha, concatena cod_pac & cod_prd e depois dá um procv dessa concatenação com a concatenação do primeiro script.
--Copia valor_tot para a última coluna.
--Retira todos os #N/D (itens de OPME que não são do fornecedor solicitado)

--Quitação: utiliza os cod_pac do filtro acima (após retirar os #N/D) no script abaixo (3) e remover as duplicatas
select cod_fatura, cod_produto, cod_pac, data_baixa, valor_pago from quitacao_produto
where cod_pac in ('M854842','M854842','M836006','M836006','M836006','M829380','M829380','M829380','M829380','M829380','M829817','M829817','M829817','M829817','M829817','M822821','M822821','M822821','M822821','M822821','M822821','M822821','M795945','M801390','M801390','M801390','M801390','M801390','M801390','M801390','M800779','M800779','M800779','M800779','M800779','M800779','M800779','M800779','M800779','M785249','M785249','M785249','M785249','M785249','M785249','M785249','M789522','M782687','M782687','M782687','M782687','M782687','M789522','M781470','M781470','M762123','M694796','M694796','M694796','M726127','M704264','M704264','M704264','M704264','M704264','M704264','M704264','M704264','M704264','M704264','M704264','M704264','M704010','M704010','M704010','M697888','M697888','M697888','M684638','M684638','M684638','M684638','M684638','M685575','M685575','M680616','M680616','M634640','M634640','M634640','M634640','M634640','M682713','M679819','M679819','M645453','M645453','M651353','M651353','M651353','M651353','M651353','M651353','M651353','M651353','M651353','M651353','M651353','M649816','M649816','M649816','M649816','M649816','M649816','M649816','M649816','M649816','M635445','M622345','M612763','M612763','M612763','M595509','M595509','M595509','M595509','M595509','M591035','M591035','M431936','M431936','M566475','M486954','M486954','M549382','M549382','M549382','M549382','M549382','M549382','M549382','M550276','M550276','M550276','M550276','M550276','M511418','M536118','M536118','M536118','M536118','M536118','M536118','M537403','M537403','M530400','M521290','M521290','M521290','M521290','M523784','M523784','M523784','M522016','M522016','M522016','M511418','M511418','M511418','M518141','M518141','M518141','M518141','M518141','M513214','M513214','M494328','M494328','M500430','M500430','M500430','M494059','M494059','M475492','M475492','M475492','M475492','M475492','M391136','M462131','M462131','M462131','M462131','M461075','M461075','M461075','M461075','M461075','M461075','M461075','M457390','M457390','M457390','M457390','M457390','M457390','M457390','M460200','M460200','M444821','M444821','M448076','M423939','M423939','M423939','M423939','M423939','M417286','M417286','M417286','M417286','M437002','M437002','M437002','M437002','M437002','M437002','M434670','M434670','M434670','M434670','M434670','M434670','M435861','M430024','M396973','M394726','M395940','M388761','M388761','M384259','M384259','M384259','M378588','M316920','M314886','M314886','M314886','M314886','M314886','M314886','M314886','M314886','M314886','M314886','M316920','M313315','M313315','M313315','M313315','M313315','M313315','M313315','M313315','M313315','M313315','M302899','M302899','M302899','M304126','M304126','M304126','M287423','M287423','M287423','M287423','M287423','M287423','M271367','M271367','M260436','M260436','M260436','M257681','M255670','M241640','M198437','M198437','M207852','M207852','M207852','M207852','M207852','M207852','M199374','M209451','M209451','M209451','M209451','M173389','M173389','M173389','M181512','M181512','M160991','M160991','L952058','L952058','L952058','L952058','L795900','L795900','M083423','M083423','M072176','M072176','M055298','M055298','L938641','L938641','L938641','L938641','L938641','L938641','L991225','L991225','L974386','L974386','L974386','L974386','L974386','L974386','L952327','L946513','L946513','L951998','L951998','L952327','L952327','L952327','L952327','L945496','L945496','L945496','L916725','L916725','L858647','L858647','L858647','L858647','L858647','L858647','L816711','L816711','L787096','L787096','L784280','L784280','L784280','L784280','L775242','L775242','L775242','L769106','L769106','L768817','L768817','L756590','L756590','L756590','L756590','L739239','L739239','L739239','L739239','L739239','L739239','L738180','L738180','L731660','L731660','L731660','L731836','L731836','L731836','L721147','L721147','L688281','L687390','L687390','L640552','L640552','L664053','L656364','L664053','L527951','L527951','L662185','L662185','L656364','L656364','L656364','L648328','L648328','L631980','L631980','L633636','L633636','L633636','L618554','L618554','L619248','L619248','L595843','L570573','L570573','L559213','L559213','L559213','L546041','L546041','L539569','L539569','L536183','L536183','L536183','L532566','L532566','L532566','L532566','L538829','L538829','L525055')
--Essa vai ser a planilha principal.
--Na planilha, concatena cod_pac & cod_prd e depois dá um procv dessa concatenação com a concatenação do segundo script (de faturado).
--Após retirar os #N/D, faz um procv desta planilha com a de valor faturado.

--Roda o script abaixo, para linkar fatura e remessa
select fatura, remessa from fafatcad where fatura in 
('I12126','I13003','I05923','I05923','I05923','I06104','I05795','I05795','I03645','I03645','I03645','I03645','I03645','I03645','I03645','I03645','I03643','I03643','I03643','I03643','I03643','I03643','I03643','I03643','I03643','I11797','I11797','I08216','I11787','I09356','I06783','I06783','I06783','I06783','I06783','I01583','I01583','I01757','H99461','H99461','H99461','H99461','H99461','I01750','I01750','I01750','I01750','I01750','I01750','I01750','H99435','H99435','I01592','I01592','I01592','I01592','I01592','I01592','I01691','I03063','I03063','I03063','H98159','H98159','H98159','I13750','I13750','I13740','I13740','H98296','H98296','I07902','I07902','I07902','I10627','I10627','H96626','H96626','I09312','I09312','H98298','H98298','H98298','H98298','H94291','H94291','H94291','H94291','H94291','H94291','I00819','I00819','H97097','H97097','H97097','H97097','H97097','H97097','H97097','H92321','I06957','I06957','H95418','H93770','H93770','H93770','H93770','H93770','H93770','I09568','I09568','H90948','H94796','H94796','H94796','H90974','H97491','H90547','H89640','H89640','H86843','H86843','H86843','H89810','H93559','H96868','H96868','H96868','H85613','H85613','H81661','H81661','H81661','H77391','H83745','H76777','H76777','H76777','H71962','H71962','H71962','H87405','H79605','H79605','H81827','H81827','H73338','H73338','H73338','H80327','H80327','H76492','H71865','H71865','H68580','H68580','H78616','H78616','H60908','H60908','H60908','H66002','H66002','H70347','H70347','H63534','H63534','H63534','H75956','H75956','H75956','H75956','H75956','H75956','H55367','H55367','H48984','H48984','H93508','H44405','H44405','H46154','H46154','H46154','H46154','H42764','H42764','H42764','H58099','H44436','H44436','H51656','H51656','H43668','H43668','H43668','H43668','H42878','H42878','H75955','H75955','H75955','H40052','H40052','H40052','H41337','H41337','H39975','H42755','H42755','H38677','H38677','H38418','H38418','H38915','H38915','H41763','H41763','H32569','H32569','H32569','H35487','H35487','H43666','H43666','H36731','H36731','H35009','H33034','H33034','H31996','H31996','H31996','H33919','H33919','H32638','H32638','H34955','H34955','H66724','H66724','H66724','H31373','H31373','H31373','H46739','H46739','H23953')
--Com o resultado, faz um procv da planilha principal, na coluna cod_fatura, com o resultado acima, para buscar a remessa

--Roda o script abaixo, para pegar a data de baixa
select remessa, data_entre from faremcad where remessa in 
(select remessa from fafatcad where fatura in 
('I12126','I13003','I05923','I05923','I05923','I06104','I05795','I05795','I03645','I03645','I03645','I03645','I03645','I03645','I03645','I03645','I03643','I03643','I03643','I03643','I03643','I03643','I03643','I03643','I03643','I11797','I11797','I08216','I11787','I09356','I06783','I06783','I06783','I06783','I06783','I01583','I01583','I01757','H99461','H99461','H99461','H99461','H99461','I01750','I01750','I01750','I01750','I01750','I01750','I01750','H99435','H99435','I01592','I01592','I01592','I01592','I01592','I01592','I01691','I03063','I03063','I03063','H98159','H98159','H98159','I13750','I13750','I13740','I13740','H98296','H98296','I07902','I07902','I07902','I10627','I10627','H96626','H96626','I09312','I09312','H98298','H98298','H98298','H98298','H94291','H94291','H94291','H94291','H94291','H94291','I00819','I00819','H97097','H97097','H97097','H97097','H97097','H97097','H97097','H92321','I06957','I06957','H95418','H93770','H93770','H93770','H93770','H93770','H93770','I09568','I09568','H90948','H94796','H94796','H94796','H90974','H97491','H90547','H89640','H89640','H86843','H86843','H86843','H89810','H93559','H96868','H96868','H96868','H85613','H85613','H81661','H81661','H81661','H77391','H83745','H76777','H76777','H76777','H71962','H71962','H71962','H87405','H79605','H79605','H81827','H81827','H73338','H73338','H73338','H80327','H80327','H76492','H71865','H71865','H68580','H68580','H78616','H78616','H60908','H60908','H60908','H66002','H66002','H70347','H70347','H63534','H63534','H63534','H75956','H75956','H75956','H75956','H75956','H75956','H55367','H55367','H48984','H48984','H93508','H44405','H44405','H46154','H46154','H46154','H46154','H42764','H42764','H42764','H58099','H44436','H44436','H51656','H51656','H43668','H43668','H43668','H43668','H42878','H42878','H75955','H75955','H75955','H40052','H40052','H40052','H41337','H41337','H39975','H42755','H42755','H38677','H38677','H38418','H38418','H38915','H38915','H41763','H41763','H32569','H32569','H32569','H35487','H35487','H43666','H43666','H36731','H36731','H35009','H33034','H33034','H31996','H31996','H31996','H33919','H33919','H32638','H32638','H34955','H34955','H66724','H66724','H66724','H31373','H31373','H31373','H46739','H46739','H23953')
)
--Com o procv anterior (remessa), faz um procv com este script, para pegar a data de baixa.

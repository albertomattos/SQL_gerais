SELECT
-- DISTINCT
--      TCR_CDCLIENTE
--      ,TCR_NOTITULO
--      ,TCR_DOCFISCAL
      ,TCR_LANCCTBP
      ,TO_CHAR(SUM(TCR_VLRTITULO),'999,999,999.99') TITULO
      ,COUNT(*)
--      ,TO_CHAR(SUM(LCT_VALOR),'999,999,999.99')
      ,TO_CHAR((SUM(LCT_VALOR))/(COUNT(*)),'999,999,999.99') CONTABIL
      ,TO_CHAR((SUM(LCT_VALOR))/(COUNT(*)) - SUM(TCR_VLRTITULO),'999,999,999.99') DIFEREN큐
FROM TITCR_TCR,LANCCTB_LCT
WHERE LCT_LOTE = TCR_LOTEP
      AND LCT_DATA = TCR_DTEMISSAO
      AND LCT_LANCCTB = TCR_LANCCTBP
      AND LCT_DC = 'C'
--      AND TCR_NOTITULO IN (SELECT DISTINCT A.TCR_NOTITULO FROM TITCR_TCR A WHERE A.TCR_DOCPAGAME IS NULL)
      AND TCR_CDCLIENTE = '33055146005314'
        AND TCR_LANCCTBP = '348345'
      AND TCR_NOTITULO LIKE '61137%'
--      OR TCR_NOTITULO LIKE '59040%')
--76538446000136  
GROUP BY
      TCR_CDCLIENTE
      ,TCR_NOTITULO
      ,TCR_DOCFISCAL
      ,TCR_LANCCTBP
HAVING
      (TO_CHAR((SUM(LCT_VALOR))/(COUNT(*)),'999,999,999.99')) <> TO_CHAR(SUM(TCR_VLRTITULO),'999,999,999.99')
/


SELECT
      CLIENTE
      ,TCR_NOTITULO
      ,DOCFISCAL
      ,TCR_VLRTITULO
      ,TO_CHAR(DIFEREN큐,'999,999,999.99')
      ,DIFEREN큐+TCR_VLRTITULO
FROM TITCR_TCR,
(
SELECT
 DISTINCT
      TCR_CDCLIENTE CLIENTE
--      ,TCR_NOTITULO
      ,TCR_DOCFISCAL DOCFISCAL
      ,TCR_LANCCTBP LANCCONT
      ,TO_CHAR((SUM(VLRCONT))/(COUNT(*)),'999,999,999.99') CONTABIL
      ,TO_CHAR(SUM(TCR_VLRTITULO),'999,999,999.99') TITULO
      ,(SUM(VLRCONT))/(COUNT(*)) - SUM(TCR_VLRTITULO) DIFEREN큐
      ,COUNT(*)
FROM TITCR_TCR,
(SELECT DISTINCT
       LCT_LOTE LOTECONT
       ,LCT_DATA DATACONT
       ,LCT_LANCCTB  DOCCONT
       ,SUM(LCT_VALOR) VLRCONT
 FROM LANCCTB_LCT
 WHERE LCT_DC = 'C'
 GROUP BY
       LCT_LOTE
       ,LCT_DATA
       ,LCT_LANCCTB
)
WHERE LOTECONT = TCR_LOTEP
      AND DATACONT = TCR_DTEMISSAO
      AND DOCCONT = TCR_LANCCTBP
--      AND TCR_NOTITULO IN (SELECT DISTINCT A.TCR_NOTITULO FROM TITCR_TCR A WHERE A.TCR_DOCPAGAME IS NULL)
--      AND TCR_CDCLIENTE = '152149190002'
--      AND TCR_LANCCTBP = '348345'
--      AND TCR_NOTITULO LIKE '020701%'
--      OR TCR_NOTITULO LIKE '59040%')
--76538446000136  
GROUP BY 
      TCR_CDCLIENTE
--      ,TCR_NOTITULO
      ,TCR_DOCFISCAL
      ,TCR_LANCCTBP
      ,VLRCONT
HAVING
      VLRCONT <> SUM(TCR_VLRTITULO)
)
WHERE
   TCR_CDCLIENTE = CLIENTE 
   AND TCR_DOCFISCAL = DOCFISCAL
   AND TCR_LANCCTBP = LANCCONT
   AND TCR_DOCPAGAME IS NULL
   AND TCR_TITBPARCOR IS NOT NULL
/

('0041GL          
,'60469GL         
,'61045GL        
,'59451GL         
,'61268GL         
,'60071B          
,'22401601A       
,'0017GL          
,'0346GL          
,'59046A          
,'21495201/1      
,'27009803N       
,'27010103N       
,'27006303N       
,'2192F           
,'59271O          
,'61137K          
,'60207C          
,'60330A          
,'0324A           
,'2251GL
,'59945GL         
,'60181GLA        
,'61101GL         
,'61133GL         
,'61263GL         
,'61396GL         
,'61419GL         

34028316074140  0134                 362372       75,113.68       76,490.50       -1,376.82
        1